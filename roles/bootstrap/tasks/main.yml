---
- name: Uninstall Satellite certificate
  ansible.builtin.yum:
    name: "katello-ca-consumer-*"
    state: absent
  when: capsule_install

- name: Install Satellite certificate
  ansible.builtin.dnf:
    name: "http://{{ satellite_hostname }}/pub/katello-ca-consumer-latest.noarch.rpm"
    disable_gpg_check: true
    state: present
  when: capsule_install

- name: Register to Satellite
  community.general.redhat_subscription:
    state: present
    activationkey: "{{ satellite_activation_key }}"
    org_id: "{{ satellite_organization }}"
    force_register: yes
  when: capsule_install

- name: subscription-manager refresh to get new repos for Capsule upgrade
  ansible.builtin.command: subscription-manager refresh
  when: capsule_upgrade
